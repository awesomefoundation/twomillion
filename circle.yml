machine:
  ruby:
    version: 2.1.3
  node:
    version: 0.10.28
  java:
    version: oraclejdk8

dependencies:
  override:
    - bundle install
  post:
    - bundle exec rake build:app

test:
  pre:
    - "bundle exec rake test_app":
        background: true
    - "while ! echo exit | nc localhost 4000; do sleep 1; done":
        timeout: 30
  override:
    - "curl -sS http://localhost:4000 | grep -q '<title>Spantree Technology Group, LLC</title>'"

deployment:
  production:
    branch: master
    commands:
      - bundle exec s3_website push --config-dir=public --site=public/_site
      - "sed -i 's/: www./: /g' public/s3_website.yml"
      - bundle exec s3_website push --config-dir=public --site=public/_site
  staging:
    branch: develop
    commands:
      - bundle exec s3_website push --config-dir=aws/staging --site=public/_site
      - "sed -i 's/: www./: /g' aws/staging/s3_website.yml"
      - bundle exec s3_website push --config-dir=aws/staging --site=public/_site

